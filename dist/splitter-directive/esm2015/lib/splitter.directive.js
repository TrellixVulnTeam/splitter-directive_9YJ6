import { DOCUMENT } from '@angular/common';
import { EventEmitter, Inject, Input, Output } from '@angular/core';
import { ElementRef } from '@angular/core';
import { Directive } from '@angular/core';
/** @dynamic */
export class SplitterDirective {
    constructor(el, document) {
        this.el = el;
        this.document = document;
        this.vertical = false;
        this.splits = [];
        this.size = null;
        this.splitclass = null;
        this.addstyle = null;
        this.addhoverstyle = null;
        this.onDropSplitter = new EventEmitter();
    }
    ngOnInit() {
        this.parent = this.el.nativeElement;
        let style = "";
        style += this.vertical ?
            `flex-wrap:nowrap;flex-direction:column;display-flex:!important;overflow-y:auto;${this.size ? `width: ${this.size}; max-width:${this.size};` : ``}`
            : `flex-wrap:nowrap;display-flex:!important;overflow-x:auto;${this.size ? `height: ${this.size}; max-height : ${this.size};` : ``}`;
        style += "display:flex;flex-wrap:nowrap;";
        this.parent.style += style;
        console.log(this.getStyle("." + this.splitclass));
        this.init();
    }
    init() {
        this.parent.addEventListener("dragover", (event) => { event.preventDefault(); });
        let childrens = this.parent.children.length;
        for (let i = 1; i < childrens; i++) {
            let islast = i == childrens - 1;
            let child = this.parent.children[i + this.splits.length];
            let split = this.getSplitter();
            this.parent.insertBefore(split, child);
            this.splits.push(split);
        }
        if (!this.observer) {
            this.addMutations();
        }
    }
    getSplitter() {
        let split = this.document.createElement("split");
        split.classList.add("splitter");
        if (this.splitclass) {
            split.classList.add(this.splitclass);
        }
        let style = "";
        if (this.vertical) {
            split.classList.add("splittervertical");
            style += `border-bottom:solid 4px #DCDCDC;height:0px;max-height:0px;width:100%;display:inline-block;cursor:row-resize;`;
        }
        else {
            style += `border-left:solid 4px #DCDCDC;width:0px;max-width:0px;height:100%;display:inline-block;cursor:col-resize;`;
        }
        let hoverstyle = "";
        if (this.addhoverstyle) {
            hoverstyle = style + this.addhoverstyle;
        }
        if (this.addstyle) {
            style += this.addstyle;
        }
        split.setAttribute("style", style);
        split.setAttribute("draggable", "true");
        split.draggable = true;
        split.addEventListener("mouseover", () => {
            split.classList.add("splitterhover");
            if (!this.vertical)
                split.style.borderLeftColor = "#6196B2";
            else
                split.style.borderBottomColor = "#6196B2";
            if (hoverstyle) {
                split.setAttribute("style", hoverstyle);
            }
        });
        split.addEventListener("mouseout", () => {
            split.classList.remove("splitterhover");
            if (!this.vertical)
                split.style.borderLeftColor = "#DCDCDC";
            else
                split.style.borderBottomColor = "#DCDCDC";
            if (hoverstyle) {
                split.setAttribute("style", style);
            }
        });
        let eventListener = (event) => {
            let dropx = event.pageX;
            let dropy = event.pageY;
            let splitwidth = split.offsetWidth;
            let prev = split.previousElementSibling;
            let next = split.nextElementSibling;
            prev.removeEventListener("drop", eventListener);
            next.removeEventListener("drop", eventListener);
            this.onDropSplitter.emit({ event, split, prev, next });
            if (!this.vertical) {
                let prevwidth, nextwidth;
                if (dropx < split.offsetLeft) {
                    prevwidth = prev.clientWidth - (split.offsetLeft - dropx);
                    nextwidth = next.clientWidth + (split.offsetLeft - dropx);
                }
                else {
                    prevwidth = (prev.clientWidth) + (dropx - split.offsetLeft);
                    nextwidth = (next.clientWidth) - (dropx - split.offsetLeft);
                }
                prev.style.flex = next.hasAttribute("splitgrow") ? `1 0 ${prevwidth}px` : `0 1 ${prevwidth}px`;
                next.style.flex = next.hasAttribute("splitgrow") ? `1 0 ${nextwidth}px` : `0 1 ${nextwidth}px`;
                prev.style.overflowX = "auto";
                next.style.overflowX = "auto";
            }
            else {
                let prevheight, nextheight;
                if (dropy < split.offsetTop) {
                    prevheight = prev.clientHeight - (split.offsetTop - dropy);
                    nextheight = next.clientHeight + (split.offsetTop - dropy);
                }
                else {
                    prevheight = prev.clientHeight + (dropy - split.offsetTop);
                    nextheight = next.clientHeight - (dropy - split.offsetTop);
                }
                prev.style.flex = next.hasAttribute("splitgrow") ? `1 0 ${prevheight}px` : `0 1 ${prevheight}px`;
                next.style.flex = next.hasAttribute("splitgrow") ? `1 0 ${nextheight}px` : `0 1 ${nextheight}px`;
                prev.style.overflowY = "auto";
                next.style.overflowY = "auto";
            }
        };
        split.addEventListener("dragstart", (event) => {
            let prev = split.previousElementSibling;
            let next = split.nextElementSibling;
            prev.addEventListener("drop", eventListener);
            next.addEventListener("drop", eventListener);
        });
        return split;
    }
    getPercentage(pixel) {
        let width = this.parent.offsetWidth;
        return pixel / width * 100;
    }
    getPercentageHeight(pixel) {
        let height = this.parent.offsetHeight;
        return pixel / height * 100;
    }
    addMutations() {
        let observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                this.reset();
                this.init();
            });
        });
        let config = { childList: true };
        observer.observe(this.parent, config);
        this.observer = observer;
    }
    reset() {
        this.observer.disconnect();
        this.splits.forEach((item) => {
            this.parent.removeChild(item);
        });
        this.splits = [];
        this.observer = null;
    }
    getStyle(className) {
        var cssText = "";
        var classes = this.document.styleSheets[0].rules || this.document.styleSheets[0].cssRules;
        for (var x = 0; x < classes.length; x++) {
            if (classes[x].selectorText == className) {
                cssText += classes[x].cssText || classes[x].style.cssText;
            }
        }
        return cssText;
    }
}
SplitterDirective.decorators = [
    { type: Directive, args: [{
                selector: '[splitterDirective]'
            },] }
];
SplitterDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: Document, decorators: [{ type: Inject, args: [DOCUMENT,] }] }
];
SplitterDirective.propDecorators = {
    vertical: [{ type: Input }],
    size: [{ type: Input }],
    splitclass: [{ type: Input }],
    addstyle: [{ type: Input }],
    addhoverstyle: [{ type: Input }],
    onDropSplitter: [{ type: Output }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3BsaXR0ZXIuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvc3BsaXR0ZXItZGlyZWN0aXZlL3NyYy9saWIvc3BsaXR0ZXIuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMzQyxPQUFPLEVBQUMsWUFBWSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQ2xFLE9BQU0sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDMUMsT0FBTyxFQUFDLFNBQVMsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUN4QyxlQUFlO0FBSWYsTUFBTSxPQUFPLGlCQUFpQjtJQWExQixZQUFvQixFQUFjLEVBQTJCLFFBQW1CO1FBQTVELE9BQUUsR0FBRixFQUFFLENBQVk7UUFBMkIsYUFBUSxHQUFSLFFBQVEsQ0FBVztRQVp2RSxhQUFRLEdBQWEsS0FBSyxDQUFDO1FBRzVCLFdBQU0sR0FBRyxFQUFFLENBQUM7UUFDSCxTQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ1osZUFBVSxHQUFHLElBQUksQ0FBQztRQUNsQixhQUFRLEdBQUcsSUFBSSxDQUFDO1FBQ2hCLGtCQUFhLEdBQUcsSUFBSSxDQUFDO1FBRzVCLG1CQUFjLEdBQXFCLElBQUksWUFBWSxFQUFFLENBQUM7SUFJaEUsQ0FBQztJQUVELFFBQVE7UUFDTixJQUFJLENBQUMsTUFBTSxHQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDO1FBQ3JDLElBQUksS0FBSyxHQUFHLEVBQUUsQ0FBQztRQUNmLEtBQUssSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDeEIsa0ZBQWtGLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLFVBQVUsSUFBSSxDQUFDLElBQUksZUFBZSxJQUFJLENBQUMsSUFBSSxH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bW1vbic7XG5pbXBvcnQge0V2ZW50RW1pdHRlciwgSW5qZWN0LCBJbnB1dCwgT3V0cHV0fSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydHsgRWxlbWVudFJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtEaXJlY3RpdmV9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuLyoqIEBkeW5hbWljICovXG5ARGlyZWN0aXZlKHtcbiAgICBzZWxlY3RvciA6ICdbc3BsaXR0ZXJEaXJlY3RpdmVdJ1xufSlcbmV4cG9ydCBjbGFzcyBTcGxpdHRlckRpcmVjdGl2ZSB7XG4gICAgQElucHV0KCkgdmVydGljYWwgOiBib29sZWFuID0gZmFsc2U7XG4gICAgcHJpdmF0ZSBwYXJlbnRQb3NpdGlvbjtcbiAgICBwcml2YXRlIHBhcmVudDtcbiAgICBwcml2YXRlIHNwbGl0cyA9IFtdO1xuICAgIEBJbnB1dCgpIHByaXZhdGUgc2l6ZSA9IG51bGw7XG4gICAgQElucHV0KCkgcHJpdmF0ZSBzcGxpdGNsYXNzID0gbnVsbDtcbiAgICBASW5wdXQoKSBwcml2YXRlIGFkZHN0eWxlID0gbnVsbDtcbiAgICBASW5wdXQoKSBwcml2YXRlIGFkZGhvdmVyc3R5bGUgPSBudWxsO1xuXG4gICAgcHJpdmF0ZSBvYnNlcnZlcjtcbiAgICBAT3V0cHV0KCkgb25Ecm9wU3BsaXR0ZXI6RXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBlbDogRWxlbWVudFJlZixASW5qZWN0KERPQ1VNRU5UKSBwcml2YXRlIGRvY3VtZW50IDogRG9jdW1lbnQpe1xuICAgICAgIFxuICAgIH1cblxuICAgIG5nT25Jbml0KCl7XG4gICAgICB0aGlzLnBhcmVudCA9ICB0aGlzLmVsLm5hdGl2ZUVsZW1lbnQ7XG4gICAgICBsZXQgc3R5bGUgPSBcIlwiO1xuICAgICAgc3R5bGUgKz0gdGhpcy52ZXJ0aWNhbCA/IFxuICAgICAgYGZsZXgtd3JhcDpub3dyYXA7ZmxleC1kaXJlY3Rpb246Y29sdW1uO2Rpc3BsYXktZmxleDohaW1wb3J0YW50O292ZXJmbG93LXk6YXV0bzske3RoaXMuc2l6ZSA/IGB3aWR0aDogJHt0aGlzLnNpemV9OyBtYXgtd2lkdGg6JHt0aGlzLnNpemV9O2AgOiBgYH1gIFxuICAgICAgOiBgZmxleC13cmFwOm5vd3JhcDtkaXNwbGF5LWZsZXg6IWltcG9ydGFudDtvdmVyZmxvdy14OmF1dG87JHt0aGlzLnNpemUgPyBgaGVpZ2h0OiAke3RoaXMuc2l6ZX07IG1heC1oZWlnaHQgOiAke3RoaXMuc2l6ZX07YCA6IGBgfWA7XG4gICAgICAgIHN0eWxlICs9IFwiZGlzcGxheTpmbGV4O2ZsZXgtd3JhcDpub3dyYXA7XCI7XG4gICAgICAgIHRoaXMucGFyZW50LnN0eWxlICs9IHN0eWxlO1xuICAgICAgY29uc29sZS5sb2codGhpcy5nZXRTdHlsZShcIi5cIit0aGlzLnNwbGl0Y2xhc3MpKTtcbiAgICAgIHRoaXMuaW5pdCgpO1xuICAgIH1cblxuICAgIGluaXQoKXtcbiAgICAgIFxuICAgICAgICAgICAgdGhpcy5wYXJlbnQuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdvdmVyXCIsKGV2ZW50KSA9PiB7IGV2ZW50LnByZXZlbnREZWZhdWx0KCk7fSlcbiAgICAgICAgICAgIGxldCBjaGlsZHJlbnMgPSB0aGlzLnBhcmVudC5jaGlsZHJlbi5sZW5ndGg7XG4gICAgICAgICAgICBmb3IobGV0IGk9MSA7IGkgPCBjaGlsZHJlbnMgOyBpKyspe1xuICAgICAgICAgICAgICAgIGxldCBpc2xhc3QgPSBpID09IGNoaWxkcmVucyAtMSA7XG4gICAgICAgICAgICAgICAgbGV0IGNoaWxkID0gdGhpcy5wYXJlbnQuY2hpbGRyZW5baSt0aGlzLnNwbGl0cy5sZW5ndGhdO1xuICAgICAgICAgICAgICAgIGxldCBzcGxpdCA9IHRoaXMuZ2V0U3BsaXR0ZXIoKTtcbiAgICAgICAgICAgICAgICB0aGlzLnBhcmVudC5pbnNlcnRCZWZvcmUoc3BsaXQsY2hpbGQpO1xuICAgICAgICAgICAgICAgIHRoaXMuc3BsaXRzLnB1c2goc3BsaXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoIXRoaXMub2JzZXJ2ZXIpe1xuICAgICAgICAgICAgICAgIHRoaXMuYWRkTXV0YXRpb25zKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBcbiAgICB9XG5cbiAgICBnZXRTcGxpdHRlcigpe1xuICAgICAgICBsZXQgc3BsaXQgPSB0aGlzLmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGxpdFwiKTtcbiAgICAgICAgc3BsaXQuY2xhc3NMaXN0LmFkZChcInNwbGl0dGVyXCIpO1xuICAgICAgICBpZih0aGlzLnNwbGl0Y2xhc3Mpe1xuICAgICAgICAgIHNwbGl0LmNsYXNzTGlzdC5hZGQodGhpcy5zcGxpdGNsYXNzKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgc3R5bGUgPSBcIlwiXG4gICAgICAgIGlmKHRoaXMudmVydGljYWwpe1xuICAgICAgICAgICAgc3BsaXQuY2xhc3NMaXN0LmFkZChcInNwbGl0dGVydmVydGljYWxcIik7XG4gICAgICAgICAgICBzdHlsZSArPSBgYm9yZGVyLWJvdHRvbTpzb2xpZCA0cHggI0RDRENEQztoZWlnaHQ6MHB4O21heC1oZWlnaHQ6MHB4O3dpZHRoOjEwMCU7ZGlzcGxheTppbmxpbmUtYmxvY2s7Y3Vyc29yOnJvdy1yZXNpemU7YDtcbiAgICAgICAgfVxuICAgICAgICBlbHNle1xuICAgICAgICAgICAgc3R5bGUgKz0gYGJvcmRlci1sZWZ0OnNvbGlkIDRweCAjRENEQ0RDO3dpZHRoOjBweDttYXgtd2lkdGg6MHB4O2hlaWdodDoxMDAlO2Rpc3BsYXk6aW5saW5lLWJsb2NrO2N1cnNvcjpjb2wtcmVzaXplO2A7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGhvdmVyc3R5bGUgPSBcIlwiO1xuICAgICAgICBpZih0aGlzLmFkZGhvdmVyc3R5bGUpe1xuICAgICAgICAgIGhvdmVyc3R5bGUgPSBzdHlsZSArIHRoaXMuYWRkaG92ZXJzdHlsZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmKHRoaXMuYWRkc3R5bGUpe1xuICAgICAgICAgIHN0eWxlICs9IHRoaXMuYWRkc3R5bGU7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHNwbGl0LnNldEF0dHJpYnV0ZShcInN0eWxlXCIsc3R5bGUpO1xuICAgICAgICBzcGxpdC5zZXRBdHRyaWJ1dGUoXCJkcmFnZ2FibGVcIixcInRydWVcIik7XG4gICAgICAgIHNwbGl0LmRyYWdnYWJsZSA9IHRydWU7XG4gICAgICAgIHNwbGl0LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW92ZXJcIiwoKSA9PiB7XG4gICAgICAgICAgc3BsaXQuY2xhc3NMaXN0LmFkZChcInNwbGl0dGVyaG92ZXJcIik7XG4gICAgICAgICAgaWYoIXRoaXMudmVydGljYWwpXG4gICAgICAgICAgc3BsaXQuc3R5bGUuYm9yZGVyTGVmdENvbG9yID0gXCIjNjE5NkIyXCI7XG4gICAgICAgICAgZWxzZVxuICAgICAgICAgIHNwbGl0LnN0eWxlLmJvcmRlckJvdHRvbUNvbG9yID0gXCIjNjE5NkIyXCI7XG5cbiAgICAgICAgICBpZihob3ZlcnN0eWxlKXtcbiAgICAgICAgICAgIHNwbGl0LnNldEF0dHJpYnV0ZShcInN0eWxlXCIsaG92ZXJzdHlsZSk7XG5cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBzcGxpdC5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdXRcIiwoKSA9PiB7XG4gICAgICAgICAgc3BsaXQuY2xhc3NMaXN0LnJlbW92ZShcInNwbGl0dGVyaG92ZXJcIik7XG4gICAgICAgICAgXG4gICAgICAgICAgaWYoIXRoaXMudmVydGljYWwpXG4gICAgICAgICAgc3BsaXQuc3R5bGUuYm9yZGVyTGVmdENvbG9yID0gXCIjRENEQ0RDXCI7XG4gICAgICAgICAgZWxzZVxuICAgICAgICAgIHNwbGl0LnN0eWxlLmJvcmRlckJvdHRvbUNvbG9yID0gXCIjRENEQ0RDXCI7XG5cbiAgICAgICAgICBpZihob3ZlcnN0eWxlKXtcbiAgICAgICAgICAgIHNwbGl0LnNldEF0dHJpYnV0ZShcInN0eWxlXCIsc3R5bGUpO1xuXG4gICAgICAgICAgfVxuICAgICAgICB9KVxuXG4gICAgICAgIGxldCBldmVudExpc3RlbmVyID0gKGV2ZW50KSA9PiB7XG4gICAgICAgICAgXG4gICAgICAgICAgICBsZXQgZHJvcHggPSBldmVudC5wYWdlWDtcbiAgICAgICAgICAgIGxldCBkcm9weSA9IGV2ZW50LnBhZ2VZO1xuICAgICAgICAgICAgbGV0IHNwbGl0d2lkdGggPSBzcGxpdC5vZmZzZXRXaWR0aDtcbiAgICAgICAgICAgIGxldCBwcmV2IDogYW55ID0gc3BsaXQucHJldmlvdXNFbGVtZW50U2libGluZztcbiAgICAgICAgICAgIGxldCBuZXh0IDogYW55ID0gc3BsaXQubmV4dEVsZW1lbnRTaWJsaW5nO1xuICAgICAgICAgICAgcHJldi5yZW1vdmVFdmVudExpc3RlbmVyKFwiZHJvcFwiLGV2ZW50TGlzdGVuZXIpO1xuICAgICAgICAgICAgbmV4dC5yZW1vdmVFdmVudExpc3RlbmVyKFwiZHJvcFwiLGV2ZW50TGlzdGVuZXIpO1xuICAgICAgICAgICAgdGhpcy5vbkRyb3BTcGxpdHRlci5lbWl0KHtldmVudCAsIHNwbGl0ICwgcHJldiwgbmV4dH0pO1xuICAgICAgICAgICAgaWYoIXRoaXMudmVydGljYWwpe1xuICAgICAgICAgICAgICAgIGxldCBwcmV2d2lkdGgsbmV4dHdpZHRoO1xuICAgICAgICAgICAgICAgIGlmKGRyb3B4IDwgc3BsaXQub2Zmc2V0TGVmdCl7XG4gICAgICAgICAgICAgICAgICAgIHByZXZ3aWR0aCA9IHByZXYuY2xpZW50V2lkdGggLSAoc3BsaXQub2Zmc2V0TGVmdCAtIGRyb3B4KTtcbiAgICAgICAgICAgICAgICAgICAgbmV4dHdpZHRoID0gbmV4dC5jbGllbnRXaWR0aCArIChzcGxpdC5vZmZzZXRMZWZ0IC0gZHJvcHgpO1xuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2V7XG4gICAgICAgICAgICAgICAgICAgIHByZXZ3aWR0aCA9IChwcmV2LmNsaWVudFdpZHRoKSAgKyAoZHJvcHggLSBzcGxpdC5vZmZzZXRMZWZ0KTtcbiAgICAgICAgICAgICAgICAgICAgbmV4dHdpZHRoID0gKG5leHQuY2xpZW50V2lkdGgpIC0gKGRyb3B4IC0gc3BsaXQub2Zmc2V0TGVmdCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHByZXYuc3R5bGUuZmxleCA9IG5leHQuaGFzQXR0cmlidXRlKFwic3BsaXRncm93XCIpID8gYDEgMCAke3ByZXZ3aWR0aH1weGAgOiBgMCAxICR7cHJldndpZHRofXB4YFxuICAgICAgICAgICAgICAgIG5leHQuc3R5bGUuZmxleCA9IG5leHQuaGFzQXR0cmlidXRlKFwic3BsaXRncm93XCIpID8gYDEgMCAke25leHR3aWR0aH1weGAgOiBgMCAxICR7bmV4dHdpZHRofXB4YFxuICAgICAgICAgICAgICAgIHByZXYuc3R5bGUub3ZlcmZsb3dYID0gXCJhdXRvXCI7XG4gICAgICAgICAgICAgICAgbmV4dC5zdHlsZS5vdmVyZmxvd1g9XCJhdXRvXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNle1xuICAgICAgICAgICAgICAgIGxldCBwcmV2aGVpZ2h0LG5leHRoZWlnaHQ7XG4gICAgICAgICAgICAgICAgaWYoZHJvcHkgPCBzcGxpdC5vZmZzZXRUb3Ape1xuICAgICAgICAgICAgICAgICAgICBwcmV2aGVpZ2h0ID0gcHJldi5jbGllbnRIZWlnaHQgLSAoc3BsaXQub2Zmc2V0VG9wIC0gZHJvcHkpO1xuICAgICAgICAgICAgICAgICAgICBuZXh0aGVpZ2h0ID0gbmV4dC5jbGllbnRIZWlnaHQgKyAoc3BsaXQub2Zmc2V0VG9wIC0gZHJvcHkpO1xuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2V7XG4gICAgICAgICAgICAgICAgICAgIHByZXZoZWlnaHQgPSBwcmV2LmNsaWVudEhlaWdodCArIChkcm9weSAtIHNwbGl0Lm9mZnNldFRvcCk7XG4gICAgICAgICAgICAgICAgICAgIG5leHRoZWlnaHQgPSBuZXh0LmNsaWVudEhlaWdodCAtIChkcm9weSAtIHNwbGl0Lm9mZnNldFRvcCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHByZXYuc3R5bGUuZmxleCA9IG5leHQuaGFzQXR0cmlidXRlKFwic3BsaXRncm93XCIpID8gYDEgMCAke3ByZXZoZWlnaHR9cHhgIDogYDAgMSAke3ByZXZoZWlnaHR9cHhgXG4gICAgICAgICAgICAgICAgbmV4dC5zdHlsZS5mbGV4ID0gbmV4dC5oYXNBdHRyaWJ1dGUoXCJzcGxpdGdyb3dcIikgPyBgMSAwICR7bmV4dGhlaWdodH1weGAgOiBgMCAxICR7bmV4dGhlaWdodH1weGBcbiAgICAgICAgICAgICAgICBwcmV2LnN0eWxlLm92ZXJmbG93WSA9IFwiYXV0b1wiO1xuICAgICAgICAgICAgICAgIG5leHQuc3R5bGUub3ZlcmZsb3dZPVwiYXV0b1wiO1xuICAgICAgICAgICAgfVxuICAgICAgXG4gICAgICAgIH1cblxuICAgICAgICBzcGxpdC5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ3N0YXJ0XCIsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgbGV0IHByZXYgOiBhbnkgPSBzcGxpdC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nO1xuICAgICAgICAgICAgbGV0IG5leHQgOiBhbnkgPSBzcGxpdC5uZXh0RWxlbWVudFNpYmxpbmc7XG4gICAgICAgICAgICBwcmV2LmFkZEV2ZW50TGlzdGVuZXIoXCJkcm9wXCIsZXZlbnRMaXN0ZW5lcik7XG4gICAgICAgICAgICBuZXh0LmFkZEV2ZW50TGlzdGVuZXIoXCJkcm9wXCIsZXZlbnRMaXN0ZW5lcik7XG4gICAgICAgIH0pXG4gICAgICAgIHJldHVybiBzcGxpdDtcbiAgICB9XG5cbiAgICBnZXRQZXJjZW50YWdlKHBpeGVsKXtcbiAgICAgICAgbGV0IHdpZHRoID0gdGhpcy5wYXJlbnQub2Zmc2V0V2lkdGg7XG4gICAgICAgIHJldHVybiBwaXhlbC93aWR0aCoxMDA7XG4gICAgfVxuICAgIGdldFBlcmNlbnRhZ2VIZWlnaHQocGl4ZWwpe1xuICAgICAgICBsZXQgaGVpZ2h0ID0gdGhpcy5wYXJlbnQub2Zmc2V0SGVpZ2h0O1xuICAgICAgICByZXR1cm4gcGl4ZWwvaGVpZ2h0KjEwMDtcbiAgICB9XG5cbiAgICBhZGRNdXRhdGlvbnMoKXtcbiAgICAgICAgbGV0IG9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoKG11dGF0aW9ucykgPT4ge1xuICAgICAgICAgICAgbXV0YXRpb25zLmZvckVhY2goKG11dGF0aW9uKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXNldCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuaW5pdCgpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfSk7XG4gICAgXG4gICAgICAgIGxldCBjb25maWcgPSB7Y2hpbGRMaXN0IDogdHJ1ZX07XG4gICAgICAgIG9ic2VydmVyLm9ic2VydmUodGhpcy5wYXJlbnQsY29uZmlnKTtcbiAgICAgICAgdGhpcy5vYnNlcnZlciA9IG9ic2VydmVyO1xuICAgIH1cblxuICAgIHJlc2V0KCl7XG4gICAgICAgIHRoaXMub2JzZXJ2ZXIuZGlzY29ubmVjdCgpO1xuICAgICAgICB0aGlzLnNwbGl0cy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBhcmVudC5yZW1vdmVDaGlsZChpdGVtKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc3BsaXRzID0gW107XG4gICAgICAgIHRoaXMub2JzZXJ2ZXIgPSBudWxsO1xuICAgIH1cblxuICAgIFxuXG4gICAgIGdldFN0eWxlKGNsYXNzTmFtZSkge1xuICAgICAgdmFyIGNzc1RleHQgPSBcIlwiO1xuICAgICAgdmFyIGNsYXNzZXMgOiBhbnk9IHRoaXMuZG9jdW1lbnQuc3R5bGVTaGVldHNbMF0ucnVsZXMgfHwgdGhpcy5kb2N1bWVudC5zdHlsZVNoZWV0c1swXS5jc3NSdWxlcztcbiAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgY2xhc3Nlcy5sZW5ndGg7IHgrKykgeyAgICAgICAgXG4gICAgICAgICAgaWYgKGNsYXNzZXNbeF0uc2VsZWN0b3JUZXh0ID09IGNsYXNzTmFtZSkge1xuICAgICAgICAgICAgICBjc3NUZXh0ICs9IGNsYXNzZXNbeF0uY3NzVGV4dCB8fCBjbGFzc2VzW3hdLnN0eWxlLmNzc1RleHQ7XG4gICAgICAgICAgfSAgICAgICAgIFxuICAgICAgfVxuICAgICAgcmV0dXJuIGNzc1RleHQ7XG4gIH1cblxufSJdfQ==